{"_id":"_design/container","_rev":"5-66681110cdd1f7843c197dd0a21e914f","views":{"sort-by-letter":{"reduce":"_sum","map":"//----------------------------------------------------------------------------------------\n// START COUCHDB VIEW\n//----------------------------------------------------------------------------------------\n\n\n//----------------------------------------------------------------------------------------\nfunction do_csl(doc) {\n  if (doc.message) {\n  \n  \tvar jsonld = {};\n  \t\n  \tjsonld[\"@context\"] = \"http://schema.org\";\n  \tjsonld[\"@id\"] = doc._id;\n  \t\n  \t\n\t\t\tswitch (doc.message.type) {\n\t\t\t  case 'article-journal':\n\t\t\t  case 'journal-article':\n\t\t\t    \tjsonld[\"@type\"] = \"ScholarlyArticle\";\n\t\t\t\tbreak;\n\t\t\t  default:\n\t\t\t    \tjsonld[\"@type\"] = \"CreativeWork\";\n\t\t\t\tbreak;\n\t\t\t}\n \n    // title\n    if (doc.message.title) {\n      if (Array.isArray(doc.message.title)) {\n        jsonld.name = doc.message.title[0];\n      } else {\n       jsonld.name = doc.message.title;\n      }\n    }\n    \n   if (doc.message.abstract) {\n      jsonld.description = doc.message.abstract;\n    }\n     \n    // date\n    if (doc.message.issued) {\n \t     var date = '';\n\t     var dateparts = doc.message.issued['date-parts'][0];\n\t     \n\t     switch (dateparts.length) {\n\t        case 1:\n\t           date = dateparts[0];\n\t           break;\n\t        case 2:\n\t           date = dateparts[0] + '-' + (\"00\" + dateparts[1]).slice(-2) + '-00';\n\t           break;\n\t        case 3:\n\t           date = dateparts[0] + '-' + (\"00\" + dateparts[1]).slice(-2) + '-' + (\"00\" + dateparts[2]).slice(-2);\t           \n\t           break;\n\t        default:\n\t        \tbreak;\n\t    }\n\t    jsonld.datePublished = String(date);\n   }\n   \n  // container\n    if (doc.message['container-title']) {\n      var container = {};\n      if (Array.isArray(doc.message['container-title'])) {\n        container.name = doc.message['container-title'][0];\n      } else {\n       container.name = doc.message['container-title'];\n      }\n      \n\t\t\tswitch (doc.message.type) {\n\t\t\t  case 'article-journal':\n\t\t\t  case 'journal-article':\n\t\t\t    \tcontainer[\"@type\"] = \"Periodical\";\n\t\t\t\tbreak;\n\t\t\t  default:\n\t\t\t    \tcontainer[\"@type\"] = \"CreativeWork\";\n\t\t\t\tbreak;\n\t\t\t}      \n\t\t\t\n   if (doc.message.ISSN) {\n      if (Array.isArray(doc.message.ISSN)) {\n        container.issn = [];\n        for (var i in doc.message.ISSN) {\n          container.issn.push(doc.message.ISSN[i]);\n        }\n      } else {\n       container.issn = [doc.message.ISSN];\n      }\n    }\t\t\t\n      \n      jsonld.isPartOf = container;\n    }   \n   \n   // volume\n    if (doc.message.volume) {\n      jsonld.volume = doc.message.volume;\n    }\n    \n    // issue\n   if (doc.message.issue) {\n      jsonld.volume = doc.message.issue;\n    }    \n    \n    // page\n\t\tif (doc.message.page) {\n\t\t\tvar parts = doc.message.page.match(/^(.*)\\-(.*)$/);\n\t\t\tif (parts) {\n\t\t\t  jsonld.pageStart = parts[1];\n\t\t\t  jsonld.pageEnd = parts[2];\n\t\t\t} else {\n\t\t\t  jsonld.pagination = doc.message.page\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (doc.message.author) {\n\t\t  jsonld.creator = [];\n\t\t  for (var i in doc.message.author) {\n\t\t    var person = {};\n\t\t    person[\"@type\"] = \"Person\";\n\t\t    person.name = '';\n\t\t    \n\t\t    if (doc.message.author[i].given) {\n\t\t      person.name += doc.message.author[i].given;\n\t\t    }\n\t\t    if (doc.message.author[i].family) {\n\t\t      person.name += ' ' + doc.message.author[i].family;\n\t\t    }\n\t\t    if (doc.message.author[i].literal) {\n\t\t      person.name = doc.message.author[i].literal;\n\t\t    }\n\t\t    jsonld.creator.push(person);\n\t\t  }\n\t\t}\n\t\t\n\t\t\t// links to representions such as PDFs, XML, HTML, etc.\n\t\t\t// may be links to text mining sources\n\t\tif (doc.message.link) {\n\t\t  jsonld.encoding = [];\n\t\t\tfor (var i in doc.message.link) {\n        var link = {};\n\t\t\t  // type\n\t\t\t  link[\"@type\"] = \"MediaObject\";\n\t\t\t  \n\t\t\t  if (doc.message.link[i].URL) {\n\t\t\t    link.contentUrl = doc.message.link[i].URL;\n\t\t\t  }\n\t\t\t  if (doc.message.link[i]['content-type']) {\n\t\t\t    link.fileFormat = doc.message.link[i]['content-type'];\n\t\t\t  }\n\t\t\t  \n\t\t\t  jsonld.encoding.push(link);\n\n\t\t\t  }\n\t\t\t}\n\t\t\n    // license\n    if (doc.message.license) {\n      if (Array.isArray(doc.message.license)) {\n        jsonld.license = [];\n        for (var i in doc.message.license) {\n          if (doc.message.license[i].URL) {\n            jsonld.license.push(doc.message.license[i].URL);\n          }\n        }\n      } else {\n       jsonld.license = doc.message.license;\n      }\n    }\t\n    \n    if (doc.message.reference) {\n      jsonld.citation = [];\n      \n      for (var i in doc.message.reference) {\n        var citation = {};\n        if (doc.message.reference[i].DOI) {\n          citation[\"@id\"] = \"https://doi.org/\" + doc.message.reference[i].DOI;\n        }\n        if (doc.message.reference[i]['article-title']) {\n          citation.name = doc.message.reference[i]['article-title'];\n        }\n        if (doc.message.reference[i].unstructured) {\n          citation.name = doc.message.reference[i].unstructured;\n        }\n        json.citation.push(citation);\n      }\n    }\n\t\t\t\n  \n     emit(doc._id, jsonld);\n  }\n}\n\n//----------------------------------------------------------------------------------------\nfunction do_reference(doc) {\n  if (doc.message) {\n  \n  \tvar jsonld = {};\n  \t\n  \tjsonld[\"@context\"] = \"http://schema.org\";\n  \tjsonld[\"@id\"] = doc._id;\n  \tjsonld[\"@type\"] = \"CreativeWork\";\n \n    // title\n    if (doc.message['article-title']) {\n       jsonld.name = doc.message['article-title'];\n    }\n\n    if (doc.message['volume-title']) {\n       jsonld.name = doc.message['volume-title'];\n    }\n    \n   if (doc.message.unstructured) {\n      jsonld.description = doc.message.unstructured;\n    }\n    \n    if (doc.message.year) {\n      jsonld.datePublished = doc.message.year;\n    }    \n       \n  // container\n    if (doc.message['journal-title']) {\n      var container = {};\n      container.name = doc.message['journal-title'];\n\t  container[\"@type\"] = \"Periodical\";\n\t\t\t\n     if (doc.message.ISSN) {\n       container.issn = [doc.message.ISSN];\n      }\n      jsonld.isPartOf = container;\n    }\t\t\t\n   \n   // volume\n    if (doc.message.volume) {\n      jsonld.volume = doc.message.volume;\n    }\n    \n    // issue\n   if (doc.message.issue) {\n      jsonld.issueNumber = doc.message.issue;\n    }    \n\n   if (doc.message['first-page']) {\n      jsonld.pageStart = doc.message['first-page'];\n    }    \n    \n    \n\t\tif (doc.message.author) {\n\t\t  jsonld.creator = [];\n\t\t  \n\t\t  if (Array.isArray(doc.message.author)) {\n\t\t    for (var i in doc.message.author) {\n\t\t      var person = {};\n\t\t      person[\"@type\"] = \"Person\";\n\t\t      person.name = doc.message.author[i];\n\t\t \t  jsonld.creator.push(person);\n\t\t \t }\n\t\t  \n\t\t  } else {\n\t\t  \tvar person = {};\n\t\t    person[\"@type\"] = \"Person\";\n\t\t    person.name = doc.message.author;\n\t\t    \n\t\t    jsonld.creator.push(person);\n\t\t  }\n\t\t}\n\n\n\t\t\t\n  \n     emit(doc._id, jsonld);\n  }\n}\n\n//----------------------------------------------------------------------------------------\nfunction do_zoobank(doc) {\n  if (doc.message) {\n  \n  \tvar jsonld = {};\n  \t\n  \tjsonld[\"@context\"] = \"http://schema.org\";\n  \tjsonld[\"@id\"] = doc._id;\n  \tjsonld[\"@type\"] = \"CreativeWork\";\n \n    // title\n    if (doc.message.title) {\n       jsonld.name = doc.message.title;\n    }\n\n   if (doc.message.citationdetails) {\n      jsonld.description = doc.message.citationdetails;\n    }\n    \n    if (doc.message.year) {\n      jsonld.datePublished = doc.message.year;\n    }    \n       \n  // container\n    if (doc.message.parentreference) {\n      var container = {};\n      container.name = doc.message.parentreference;\n\t  container[\"@type\"] = \"Periodical\";\n\n      jsonld.isPartOf = container;\n    }\t\t\t\n \n   // volume\n    if (doc.message.volume) {\n      jsonld.volume = doc.message.volume;\n    }\n  \n    // issue\n   if (doc.message.number) {\n      jsonld.issueNumber = doc.message.number;\n    }    \n\n   if (doc.message.pagination) {\n      jsonld.pagination = doc.message.pagination;\n    }  \n    \n   if (doc.message.startpage) {\n      jsonld.pageStart = doc.message.startpage;\n    }    \n\n   if (doc.messages.endpage) {\n      jsonld.pageEnd = doc.message.endpage;\n    }    \n    \n    \n   \n\t\tif (doc.message.authors) {\n\t\t  jsonld.creator = [];\n\t\t  \n\t\t    for (var i in doc.message.authors) {\n\t\t      var person = {};\n\t\t      person[\"@type\"] = \"Person\";\n\t\t      \n\t\t    person.name = '';\n\t\t    \n\t\t    if (doc.message.author[i].given) {\n\t\t      person.name += doc.message.author[i].givenname;\n\t\t    }\n\t\t    if (doc.message.author[i].family) {\n\t\t      person.name += ' ' + doc.message.author[i].familyname;\n\t\t    }\n\t\t     \n\t\t \t  jsonld.creator.push(person);\n\t\t \t }\n\t\t\n\t\t}\n*/\n\n\t\t\t\n  \n     emit(doc._id, jsonld);\n  }\n}\n\nfunction (doc) {\n  if (doc['message-format']) {\n\n    // ORCID work\n    if (doc['message-format'] === 'application/vnd.citationstyles.csl+json') {\n      //do_csl(doc);\n    }\n\n    // CrossRef\n    if (doc['message-format'] === 'application/vnd.crossref-api-message+json') {\n      //do_csl(doc);\n    }\n    \n    // Cited reference (e.g., from CrossRef CSL)\n    if (doc['message-format'] === 'application/vnd.crossref-citation+json') {\n      //do_reference(doc);\n    }    \n    \n    // Zoobank\n    if (doc['message-format'] === 'application/vnd.zoobank+json') {\n      do_zoobank(doc);\n    }\n\n  }\n}\n\n// END COUCHDB VIEW"}},"language":"javascript"}
