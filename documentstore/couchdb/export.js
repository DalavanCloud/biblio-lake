{"_id":"_design/export","_rev":"55-9d1ac4297bdc3fb6bff80e5489646a1a","views":{"json-ld":{"map":"\n//----------------------------------------------------------------------------------------\n// START COUCHDB VIEW\n//----------------------------------------------------------------------------------------\n//----------------------------------------------------------------------------------------\nfunction do_csl(doc) {\n  if (doc.message) {\n\n    var jsonld = {};\n\n    jsonld[\"@context\"] = \"http://schema.org\";\n    jsonld[\"@id\"] = doc._id;\n\n\n    switch (doc.message.type) {\n      case 'article-journal':\n      case 'journal-article':\n        jsonld[\"@type\"] = \"ScholarlyArticle\";\n        break;\n      default:\n        jsonld[\"@type\"] = \"CreativeWork\";\n        break;\n    }\n\n    // title\n    if (doc.message.title) {\n      if (Array.isArray(doc.message.title)) {\n        jsonld.name = doc.message.title[0];\n      } else {\n        jsonld.name = doc.message.title;\n      }\n    }\n\n    if (doc.message.abstract) {\n      jsonld.description = doc.message.abstract;\n    }\n\n    // date\n    if (doc.message.issued) {\n      var date = '';\n      var dateparts = doc.message.issued['date-parts'][0];\n\n      switch (dateparts.length) {\n        case 1:\n          date = dateparts[0];\n          break;\n        case 2:\n          date = dateparts[0] + '-' + (\"00\" + dateparts[1]).slice(-2) + '-00';\n          break;\n        case 3:\n          date = dateparts[0] + '-' + (\"00\" + dateparts[1]).slice(-2) + '-' + (\"00\" + dateparts[2]).slice(-2);\n          break;\n        default:\n          break;\n      }\n      jsonld.datePublished = String(date);\n    }\n\n    // container\n    if (doc.message['container-title']) {\n      var container = {};\n      if (Array.isArray(doc.message['container-title'])) {\n        container.name = doc.message['container-title'][0];\n      } else {\n        container.name = doc.message['container-title'];\n      }\n\n      switch (doc.message.type) {\n        case 'article-journal':\n        case 'journal-article':\n          container[\"@type\"] = \"Periodical\";\n          break;\n        default:\n          container[\"@type\"] = \"CreativeWork\";\n          break;\n      }\n\n      if (doc.message.ISSN) {\n        if (Array.isArray(doc.message.ISSN)) {\n          container.issn = [];\n          for (var i in doc.message.ISSN) {\n            container.issn.push(doc.message.ISSN[i]);\n          }\n        } else {\n          container.issn = [doc.message.ISSN];\n        }\n      }\n\n      jsonld.isPartOf = container;\n    }\n\n    // volume\n    if (doc.message.volume) {\n      jsonld.volume = doc.message.volume;\n    }\n\n    // issue\n    if (doc.message.issue) {\n      jsonld.volume = doc.message.issue;\n    }\n\n    // page\n    if (doc.message.page) {\n      var parts = doc.message.page.match(/^(.*)\\-(.*)$/);\n      if (parts) {\n        jsonld.pageStart = parts[1];\n        jsonld.pageEnd = parts[2];\n      } else {\n        jsonld.pagination = doc.message.page\n      }\n    }\n\n    if (doc.message.author) {\n      jsonld.creator = [];\n      for (var i in doc.message.author) {\n        var person = {};\n        person[\"@type\"] = \"Person\";\n        person.name = '';\n\n        if (doc.message.author[i].given) {\n          person.name += doc.message.author[i].given;\n        }\n        if (doc.message.author[i].family) {\n          person.name += ' ' + doc.message.author[i].family;\n        }\n        if (doc.message.author[i].literal) {\n          person.name = doc.message.author[i].literal;\n        }\n        jsonld.creator.push(person);\n      }\n    }\n\n    // links to representions such as PDFs, XML, HTML, etc.\n    // may be links to text mining sources\n    if (doc.message.link) {\n      jsonld.encoding = [];\n      for (var i in doc.message.link) {\n        var link = {};\n        // type\n        link[\"@type\"] = \"MediaObject\";\n\n        if (doc.message.link[i].URL) {\n          link.contentUrl = doc.message.link[i].URL;\n        }\n        if (doc.message.link[i]['content-type']) {\n          link.fileFormat = doc.message.link[i]['content-type'];\n        }\n\n        jsonld.encoding.push(link);\n\n      }\n    }\n\n    // license\n    if (doc.message.license) {\n      if (Array.isArray(doc.message.license)) {\n        jsonld.license = [];\n        for (var i in doc.message.license) {\n          if (doc.message.license[i].URL) {\n            jsonld.license.push(doc.message.license[i].URL);\n          }\n        }\n      } else {\n        jsonld.license = doc.message.license;\n      }\n    }\n\n    if (doc.message.reference) {\n      jsonld.citation = [];\n\n      for (var i in doc.message.reference) {\n        var citation = {};\n        if (doc.message.reference[i].DOI) {\n          citation[\"@id\"] = \"https://doi.org/\" + doc.message.reference[i].DOI;\n        }\n        if (doc.message.reference[i]['article-title']) {\n          citation.name = doc.message.reference[i]['article-title'];\n        }\n        if (doc.message.reference[i].unstructured) {\n          citation.name = doc.message.reference[i].unstructured;\n        }\n        jsonld.citation.push(citation);\n      }\n    }\n\n\n    emit(doc._id, jsonld);\n  }\n}\n\n//----------------------------------------------------------------------------------------\nfunction do_reference(doc) {\n  if (doc.message) {\n\n    var jsonld = {};\n\n    jsonld[\"@context\"] = \"http://schema.org\";\n    jsonld[\"@id\"] = doc._id;\n    jsonld[\"@type\"] = \"CreativeWork\";\n\n    // title\n    if (doc.message['article-title']) {\n      jsonld.name = doc.message['article-title'];\n    }\n\n    if (doc.message['volume-title']) {\n      jsonld.name = doc.message['volume-title'];\n    }\n\n    if (doc.message.unstructured) {\n      jsonld.description = doc.message.unstructured;\n    }\n\n    if (doc.message.year) {\n      jsonld.datePublished = doc.message.year;\n    }\n\n    // container\n    if (doc.message['journal-title']) {\n      var container = {};\n      container.name = doc.message['journal-title'];\n      container[\"@type\"] = \"Periodical\";\n\n      if (doc.message.ISSN) {\n        container.issn = [doc.message.ISSN];\n      }\n      jsonld.isPartOf = container;\n    }\n\n    // volume\n    if (doc.message.volume) {\n      jsonld.volume = doc.message.volume;\n    }\n\n    // issue\n    if (doc.message.issue) {\n      jsonld.issueNumber = doc.message.issue;\n    }\n\n    if (doc.message['first-page']) {\n      jsonld.pageStart = doc.message['first-page'];\n    }\n\n\n    if (doc.message.author) {\n      jsonld.creator = [];\n\n      if (Array.isArray(doc.message.author)) {\n        for (var i in doc.message.author) {\n          var person = {};\n          person[\"@type\"] = \"Person\";\n          person.name = doc.message.author[i];\n          jsonld.creator.push(person);\n        }\n\n      } else {\n        var person = {};\n        person[\"@type\"] = \"Person\";\n        person.name = doc.message.author;\n\n        jsonld.creator.push(person);\n      }\n    }\n\n\n\n\n    emit(doc._id, jsonld);\n  }\n}\n\n//----------------------------------------------------------------------------------------\nfunction do_zoobank(doc) {\n  if (doc.message) {\n\n    var jsonld = {};\n\n    jsonld[\"@context\"] = \"http://schema.org\";\n    jsonld[\"@id\"] = doc._id;\n    jsonld[\"@type\"] = \"CreativeWork\";\n\n    // title\n    if (doc.message.title) {\n      jsonld.name = doc.message.title;\n    }\n\n    if (doc.message.citationdetails) {\n      jsonld.description = doc.message.citationdetails;\n    }\n\n    if (doc.message.year) {\n      jsonld.datePublished = doc.message.year;\n    }\n\n    // container\n    if (doc.message.parentreference) {\n      var container = {};\n      container.name = doc.message.parentreference;\n      container[\"@type\"] = \"Periodical\";\n\n      jsonld.isPartOf = container;\n    }\n\n    // volume\n    if (doc.message.volume) {\n      jsonld.volume = doc.message.volume;\n    }\n\n    // issue\n    if (doc.message.number) {\n      jsonld.issueNumber = doc.message.number;\n    }\n\n    if (doc.message.pagination) {\n      jsonld.pagination = doc.message.pagination;\n    }\n\n    if (doc.message.startpage) {\n      jsonld.pageStart = doc.message.startpage;\n    }\n\n    if (doc.message.endpage) {\n      jsonld.pageEnd = doc.message.endpage;\n    }\n\n    if (doc.message.authors) {\n      jsonld.creator = [];\n\n      for (var i in doc.message.authors) {\n        var person = {};\n        person[\"@type\"] = \"Person\";\n\n        person.name = '';\n\n        if (doc.message.authors[i][0].givenname) {\n          person.name += doc.message.authors[i][0].givenname;\n        }\n        if (doc.message.authors[i][0].familyname) {\n          person.name += ' ' + doc.message.authors[i][0].familyname;\n        }\n\n        jsonld.creator.push(person);\n      }\n\n    }\n\n\n    emit(doc._id, jsonld);\n  }\n}\n\nfunction(doc) {\n  if (doc['message-format']) {\n\n    // ORCID work\n    if (doc['message-format'] === 'application/vnd.citationstyles.csl+json') {\n      do_csl(doc);\n    }\n\n    // CrossRef\n    if (doc['message-format'] === 'application/vnd.crossref-api-message+json') {\n      do_csl(doc);\n    }\n\n    // Cited reference (e.g., from CrossRef CSL)\n    if (doc['message-format'] === 'application/vnd.crossref-citation+json') {\n      do_reference(doc);\n    }\n\n    // Zoobank\n    if (doc['message-format'] === 'application/vnd.zoobank+json') {\n      do_zoobank(doc);\n    }\n\n  }\n}\n\n// END COUCHDB VIEW"}},"language":"javascript"}
