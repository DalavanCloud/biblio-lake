<html>
	<head>
		<title>Simple JSON-ld</title>
		<meta charset="UTF-8"/>
		<script src="jquery.js"></script>
		<!-- stuff below needs to go into CouchDB views -->
		<script src="shared.js"></script>
		<script src="language.js"></script>
		<style>
		td { border: 1px solid red; }
		</style>
	</head>
<body>

<h1>ZooBank to to Elastic Search</h1>


<div>
	<div style="width:100%;height:auto;">
		<h2>JSON</h2>
			<!-- JSON for data object goes below -->
			<textarea id="json" style="width:100%;background-color:#224FBC;color:#FFFF66;" rows="20">
			
{
    "_id": "https://doi.org/10.3897/phytokeys.94.21553",
    "_rev": "8-d973c421ba1a1f0b528f2cc03bc2cb24",
    "message-timestamp": "2018-05-15T15:43:38+00:00",
    "message-modified": "2018-05-15T15:43:42+00:00",
    "message-format": "application/vnd.crossref-api-message+json",
    "message-source": "https://api.crossref.org/v1/works/http://dx.doi.org/10.3897/phytokeys.94.21553",
    "message": {
        "indexed": {
            "date-parts": [
                [
                    2018,
                    1,
                    26
                ]
            ],
            "date-time": "2018-01-26T11:11:22Z",
            "timestamp": 1516965082259
        },
        "reference-count": 14,
        "publisher": "Pensoft Publishers",
        "license": [
            {
                "URL": "http://creativecommons.org/licenses/by/4.0/",
                "start": {
                    "date-parts": [
                        [
                            2018,
                            1,
                            29
                        ]
                    ],
                    "date-time": "2018-01-29T00:00:00Z",
                    "timestamp": 1517184000000
                },
                "delay-in-days": 0,
                "content-version": "vor"
            }
        ],
        "content-domain": {
            "domain": [],
            "crossmark-restriction": false
        },
        "short-container-title": [
            "PK"
        ],
        "DOI": "10.3897/phytokeys.94.21553",
        "type": "journal-article",
        "created": {
            "date-parts": [
                [
                    2018,
                    1,
                    26
                ]
            ],
            "date-time": "2018-01-26T10:29:51Z",
            "timestamp": 1516962591000
        },
        "page": "1-10",
        "source": "Crossref",
        "is-referenced-by-count": 0,
        "title": [
            "Two new species of Trivalvaria (Annonaceae) from northern Myanmar"
        ],
        "prefix": "10.3897",
        "volume": "94",
        "author": [
            {
                "given": "Bin",
                "family": "Yang",
                "affiliation": []
            },
            {
                "given": "Shishun",
                "family": "Zhou",
                "affiliation": []
            },
            {
                "given": "Hongbo",
                "family": "Ding",
                "affiliation": []
            },
            {
                "given": "Ren",
                "family": "Li",
                "affiliation": []
            },
            {
                "given": "Kyaw Win",
                "family": "Maung",
                "affiliation": []
            },
            {
                "ORCID": "http://orcid.org/0000-0001-6238-2743",
                "authenticated-orcid": true,
                "given": "Yun-Hong",
                "family": "Tan",
                "affiliation": []
            }
        ],
        "member": "2258",
        "published-online": {
            "date-parts": [
                [
                    2018,
                    1,
                    29
                ]
            ]
        },
        "reference": [
            {
                "key": "21553_B1",
                "DOI": "10.3732/ajb.1300403",
                "doi-asserted-by": "publisher"
            },
            {
                "key": "21553_B2",
                "DOI": "10.1111/j.1095-8339.2012.01235.x",
                "doi-asserted-by": "publisher"
            },
            {
                "key": "21553_B3",
                "first-page": "263",
                "article-title": "Two new species of Annonaceae from eastern India.",
                "volume": "10",
                "author": "Das",
                "year": "1968",
                "journal-title": "Bulletin of the Botanical Survey of India"
            },
            {
                "key": "21553_B4",
                "author": "Gardner",
                "year": "2015"
            },
            {
                "key": "21553_B5",
                "year": "2012"
            },
            {
                "key": "21553_B6",
                "DOI": "10.1007/978-3-662-02899-5_9",
                "doi-asserted-by": "publisher"
            },
            {
                "key": "21553_B7",
                "first-page": "1",
                "article-title": "A checklist of the trees, shrubs, herbs, and climbers of Myanmar.",
                "volume": "45",
                "author": "Kress",
                "year": "2003",
                "journal-title": "Contributions from the United States National Herbarium"
            },
            {
                "key": "21553_B8",
                "author": "Li",
                "first-page": "696",
                "year": "2011",
                "article-title": "Trivalvaria.",
                "journal-title": "19). Science Press, Beijing and Missouri Botanical Garden Press, St. Louis"
            },
            {
                "key": "21553_B9",
                "first-page": "1",
                "article-title": "Anonaceae Archipelagi Indici.",
                "volume": "2",
                "author": "Miquel",
                "year": "1865",
                "journal-title": "Annales Musei Botanici Lugduno-Batavi"
            },
            {
                "key": "21553_B10",
                "first-page": "299",
                "article-title": "Observationes phytographicae.",
                "volume": "52",
                "author": "Scheffer",
                "year": "1869",
                "journal-title": "Flora; oder, (allgemeine) botanische Zeitung"
            },
            {
                "key": "21553_B11",
                "DOI": "10.1007/s12225-009-9136-0",
                "doi-asserted-by": "publisher"
            },
            {
                "key": "21553_B12",
                "DOI": "10.1111/j.1756-1051.1997.tb00306.x",
                "doi-asserted-by": "publisher"
            },
            {
                "key": "21553_B13",
                "DOI": "10.1080/14772000.2010.542497",
                "doi-asserted-by": "publisher"
            },
            {
                "key": "21553_B14",
                "first-page": "418",
                "article-title": "Plantae novae in horto bogoriense cultae.",
                "volume": "25",
                "author": "Teijsmann",
                "year": "1863",
                "journal-title": "Natuurkundig Tijdschrift voor Nederlandsch-IndiÃ«"
            }
        ],
        "container-title": [
            "PhytoKeys"
        ],
        "original-title": [],
        "link": [
            {
                "URL": "https://phytokeys.pensoft.net/lib/ajax_srv/article_elements_srv.php?action=download_pdf&item_id=21553",
                "content-type": "application/pdf",
                "content-version": "vor",
                "intended-application": "text-mining"
            },
            {
                "URL": "https://phytokeys.pensoft.net/lib/ajax_srv/article_elements_srv.php?action=download_xml&item_id=21553",
                "content-type": "application/xml",
                "content-version": "vor",
                "intended-application": "text-mining"
            },
            {
                "URL": "https://phytokeys.pensoft.net/article_preview.php?id=21553&skip_redirect=1",
                "content-type": "unspecified",
                "content-version": "vor",
                "intended-application": "similarity-checking"
            }
        ],
        "deposited": {
            "date-parts": [
                [
                    2018,
                    1,
                    26
                ]
            ],
            "date-time": "2018-01-26T10:29:51Z",
            "timestamp": 1516962591000
        },
        "score": 1,
        "subtitle": [],
        "short-title": [],
        "issued": {
            "date-parts": [
                [
                    2018,
                    1,
                    29
                ]
            ]
        },
        "references-count": 14,
        "URL": "http://dx.doi.org/10.3897/phytokeys.94.21553",
        "relation": {
            "cites": []
        },
        "ISSN": [
            "1314-2003",
            "1314-2011"
        ],
        "issn-type": [
            {
                "value": "1314-2011",
                "type": "print"
            },
            {
                "value": "1314-2003",
                "type": "electronic"
            }
        ],
        "subject": [
            "Plant Science",
            "Ecology, Evolution, Behavior and Systematics"
        ]
    },
    "cluster_id": "https://doi.org/10.3897/phytokeys.94.21553"
}			
			</textarea>
			<br />
			<button onclick="convert()">Convert JSON to RDF</button>
	</div>
	<div style="clear:both;"></div>
	
	<div style="width:100%;">
		<h2>JSON-LD</h2>
		<div id="jsonld" style="width:100%;white-space:pre;background-color:#333;color:white;overflow:auto;"></div>

</div>			
			
		
		
		
<script>



//----------------------------------------------------------------------------------------
// START COUCHDB VIEW
//----------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------
function do_csl(doc) {
  if (doc.message) {

    var jsonld = {};

    jsonld["@context"] = "http://schema.org";
    jsonld["@id"] = doc._id;


    switch (doc.message.type) {
      case 'article-journal':
      case 'journal-article':
        jsonld["@type"] = "ScholarlyArticle";
        break;
      default:
        jsonld["@type"] = "CreativeWork";
        break;
    }

    // title
    if (doc.message.title) {
      if (Array.isArray(doc.message.title)) {
        jsonld.name = doc.message.title[0];
      } else {
        jsonld.name = doc.message.title;
      }
    }

    if (doc.message.abstract) {
      jsonld.description = doc.message.abstract;
    }

    // date
    if (doc.message.issued) {
      var date = '';
      var dateparts = doc.message.issued['date-parts'][0];

      switch (dateparts.length) {
        case 1:
          date = dateparts[0];
          break;
        case 2:
          date = dateparts[0] + '-' + ("00" + dateparts[1]).slice(-2) + '-00';
          break;
        case 3:
          date = dateparts[0] + '-' + ("00" + dateparts[1]).slice(-2) + '-' + ("00" + dateparts[2]).slice(-2);
          break;
        default:
          break;
      }
      jsonld.datePublished = String(date);
    }

    // container
    if (doc.message['container-title']) {
      var container = {};
      if (Array.isArray(doc.message['container-title'])) {
        container.name = doc.message['container-title'][0];
      } else {
        container.name = doc.message['container-title'];
      }

      switch (doc.message.type) {
        case 'article-journal':
        case 'journal-article':
          container["@type"] = "Periodical";
          break;
        default:
          container["@type"] = "CreativeWork";
          break;
      }

      if (doc.message.ISSN) {
        if (Array.isArray(doc.message.ISSN)) {
          container.issn = [];
          for (var i in doc.message.ISSN) {
            container.issn.push(doc.message.ISSN[i]);
          }
        } else {
          container.issn = [doc.message.ISSN];
        }
      }

      jsonld.isPartOf = container;
    }

    // volume
    if (doc.message.volume) {
      jsonld.volume = doc.message.volume;
    }

    // issue
    if (doc.message.issue) {
      jsonld.volume = doc.message.issue;
    }

    // page
    if (doc.message.page) {
      var parts = doc.message.page.match(/^(.*)\-(.*)$/);
      if (parts) {
        jsonld.pageStart = parts[1];
        jsonld.pageEnd = parts[2];
      } else {
        jsonld.pagination = doc.message.page
      }
    }

    if (doc.message.author) {
      jsonld.creator = [];
      for (var i in doc.message.author) {
        var person = {};
        person["@type"] = "Person";
        person.name = '';

        if (doc.message.author[i].given) {
          person.name += doc.message.author[i].given;
        }
        if (doc.message.author[i].family) {
          person.name += ' ' + doc.message.author[i].family;
        }
        if (doc.message.author[i].literal) {
          person.name = doc.message.author[i].literal;
        }
        jsonld.creator.push(person);
      }
    }

    // links to representions such as PDFs, XML, HTML, etc.
    // may be links to text mining sources
    if (doc.message.link) {
      jsonld.encoding = [];
      for (var i in doc.message.link) {
        var link = {};
        // type
        link["@type"] = "MediaObject";

        if (doc.message.link[i].URL) {
          link.contentUrl = doc.message.link[i].URL;
        }
        if (doc.message.link[i]['content-type']) {
          link.fileFormat = doc.message.link[i]['content-type'];
        }

        jsonld.encoding.push(link);

      }
    }

    // license
    if (doc.message.license) {
      if (Array.isArray(doc.message.license)) {
        jsonld.license = [];
        for (var i in doc.message.license) {
          if (doc.message.license[i].URL) {
            jsonld.license.push(doc.message.license[i].URL);
          }
        }
      } else {
        jsonld.license = doc.message.license;
      }
    }

    if (doc.message.reference) {
      jsonld.citation = [];

      for (var i in doc.message.reference) {
        var citation = {};
        if (doc.message.reference[i].DOI) {
          citation["@id"] = "https://doi.org/" + doc.message.reference[i].DOI;
        }
        if (doc.message.reference[i]['article-title']) {
          citation.name = doc.message.reference[i]['article-title'];
        }
        if (doc.message.reference[i].unstructured) {
          citation.name = doc.message.reference[i].unstructured;
        }
        jsonld.citation.push(citation);
      }
    }

    //emit(doc._id, jsonld);
    $('#jsonld').html(JSON.stringify(jsonld, null, 2));
  }
}

//----------------------------------------------------------------------------------------
function do_reference(doc) {
  if (doc.message) {

    var jsonld = {};

    jsonld["@context"] = "http://schema.org";
    jsonld["@id"] = doc._id;
    jsonld["@type"] = "CreativeWork";

    // title
    if (doc.message['article-title']) {
      jsonld.name = doc.message['article-title'];
    }

    if (doc.message['volume-title']) {
      jsonld.name = doc.message['volume-title'];
    }

    if (doc.message.unstructured) {
      jsonld.description = doc.message.unstructured;
    }

    if (doc.message.year) {
      jsonld.datePublished = doc.message.year;
    }

    // container
    if (doc.message['journal-title']) {
      var container = {};
      container.name = doc.message['journal-title'];
      container["@type"] = "Periodical";

      if (doc.message.ISSN) {
        container.issn = [doc.message.ISSN];
      }
      jsonld.isPartOf = container;
    }

    // volume
    if (doc.message.volume) {
      jsonld.volume = doc.message.volume;
    }

    // issue
    if (doc.message.issue) {
      jsonld.issueNumber = doc.message.issue;
    }

    if (doc.message['first-page']) {
      jsonld.pageStart = doc.message['first-page'];
    }


    if (doc.message.author) {
      jsonld.creator = [];

      if (Array.isArray(doc.message.author)) {
        for (var i in doc.message.author) {
          var person = {};
          person["@type"] = "Person";
          person.name = doc.message.author[i];
          jsonld.creator.push(person);
        }

      } else {
        var person = {};
        person["@type"] = "Person";
        person.name = doc.message.author;

        jsonld.creator.push(person);
      }
    }

    //emit(doc._id, jsonld);
    $('#jsonld').html(JSON.stringify(jsonld, null, 2));
  }
}

//----------------------------------------------------------------------------------------
function do_zoobank(doc) {
  if (doc.message) {

    var jsonld = {};

    jsonld["@context"] = "http://schema.org";
    jsonld["@id"] = doc._id;
    jsonld["@type"] = "CreativeWork";

    // title
    if (doc.message.title) {
      jsonld.name = doc.message.title;
    }

    if (doc.message.citationdetails) {
      jsonld.description = doc.message.citationdetails;
    }

    if (doc.message.year) {
      jsonld.datePublished = doc.message.year;
    }

    // container
    if (doc.message.parentreference) {
      var container = {};
      container.name = doc.message.parentreference;
      container["@type"] = "Periodical";

      jsonld.isPartOf = container;
    }

    // volume
    if (doc.message.volume) {
      jsonld.volume = doc.message.volume;
    }

    // issue
    if (doc.message.number) {
      jsonld.issueNumber = doc.message.number;
    }

    if (doc.message.pagination) {
      jsonld.pagination = doc.message.pagination;
    }

    if (doc.message.startpage) {
      jsonld.pageStart = doc.message.startpage;
    }

    if (doc.message.endpage) {
      jsonld.pageEnd = doc.message.endpage;
    }

    if (doc.message.authors) {
      jsonld.creator = [];

      for (var i in doc.message.authors) {
        var person = {};
        person["@type"] = "Person";

        person.name = '';

        if (doc.message.authors[i][0].givenname) {
          person.name += doc.message.authors[i][0].givenname;
        }
        if (doc.message.authors[i][0].familyname) {
          person.name += ' ' + doc.message.authors[i][0].familyname;
        }

        jsonld.creator.push(person);
      }

    }


    //emit(doc._id, jsonld);
    $('#jsonld').html(JSON.stringify(jsonld, null, 2));
    
  }
}

function couchdb(doc) {
  if (doc['message-format']) {

    // ORCID work
    if (doc['message-format'] === 'application/vnd.citationstyles.csl+json') {
      //do_csl(doc);
    }

    // CrossRef
    if (doc['message-format'] === 'application/vnd.crossref-api-message+json') {
      do_csl(doc);
    }

    // Cited reference (e.g., from CrossRef CSL)
    if (doc['message-format'] === 'application/vnd.crossref-citation+json') {
      //do_reference(doc);
    }

    // Zoobank
    if (doc['message-format'] === 'application/vnd.zoobank+json') {
      //do_zoobank(doc);
    }

  }
}

// END COUCHDB VIEW

// END COUCHDB VIEW
		
//----------------------------------------------------------------------------------------
function convert() {
	var json = $('#json').val();
	var doc = JSON.parse(json);
	
	couchdb(doc);
}

	
	</script>		
			

</div>
</body>
</html>			